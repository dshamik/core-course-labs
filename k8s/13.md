## Task 1

```shell
~ helm install --dry-run --debug python . --values values_python.yaml

NAME: python
LAST DEPLOYED: Mon Nov 27 18:44:34 2023
NAMESPACE: default
STATUS: pending-install
REVISION: 1
USER-SUPPLIED VALUES:
PVC:
  name: python-visits-pvc
  size: 1Mi
affinity: {}
autoscaling:
  enabled: false
  maxReplicas: 100
  minReplicas: 1
  targetCPUUtilizationPercentage: 80
fullnameOverride: ""
image:
  pullPolicy: IfNotPresent
  repository: dshamik/dshamik_msk_time
  tag: latest
imagePullSecrets: []
ingress:
  annotations: {}
  className: ""
  enabled: false
  hosts:
  - host: chart-example.local
    paths:
    - path: /
      pathType: ImplementationSpecific
  tls: []
nameOverride: ""
nodeSelector: {}
podAnnotations:
  vault.hashicorp.com/agent-inject: "true"
  vault.hashicorp.com/agent-inject-secret-database-config.txt: internal/data/database/config
  vault.hashicorp.com/role: internal-app
podLabels: {}
podSecurityContext: {}
replicaCount: 2
resources: {}
securityContext: {}
service:
  name: python-app
  port: 8090
  type: LoadBalancer
serviceAccount:
  annotations: {}
  automount: true
  create: true
  name: internal-app
tolerations: []
volumeMounts:
- mountPath: /config.json
  name: config
  readOnly: true
  subPath: config.json
- mountPath: /app/volume/
  name: python-visits-pvc
volumes:
- configMap:
    name: configmap
  name: config

COMPUTED VALUES:
PVC:
  name: python-visits-pvc
  size: 1Mi
affinity: {}
autoscaling:
  enabled: false
  maxReplicas: 100
  minReplicas: 1
  targetCPUUtilizationPercentage: 80
fullnameOverride: ""
image:
  pullPolicy: IfNotPresent
  repository: dshamik/dshamik_msk_time
  tag: latest
imagePullSecrets: []
ingress:
  annotations: {}
  className: ""
  enabled: false
  hosts:
  - host: chart-example.local
    paths:
    - path: /
      pathType: ImplementationSpecific
  tls: []
nameOverride: ""
nodeSelector: {}
podAnnotations:
  vault.hashicorp.com/agent-inject: "true"
  vault.hashicorp.com/agent-inject-secret-database-config.txt: internal/data/database/config
  vault.hashicorp.com/role: internal-app
podLabels: {}
podSecurityContext: {}
replicaCount: 2
resources: {}
securityContext: {}
service:
  name: python-app
  port: 8090
  type: LoadBalancer
serviceAccount:
  annotations: {}
  automount: true
  create: true
  name: internal-app
tolerations: []
volumeMounts:
- mountPath: /config.json
  name: config
  readOnly: true
  subPath: config.json
- mountPath: /app/volume/
  name: python-visits-pvc
volumes:
- configMap:
    name: configmap
  name: config

HOOKS:
---
# Source: my-app/templates/post-install-hook.yaml
apiVersion: v1
kind: Pod
metadata:
  name: postinstall-hook
  annotations:
    "helm.sh/hook": "post-install"
    "helm.sh/hook-delete-policy": hook-succeeded
spec:
  containers:
  - name: post-install-container
    image: busybox
    imagePullPolicy: IfNotPresent
    command: ['sh', '-c', 'echo The post-install hook is running && sleep 20' ]
  restartPolicy: Never
  terminationGracePeriodSeconds: 0
---
# Source: my-app/templates/pre-install-hook.yaml
apiVersion: v1
kind: Pod
metadata:
  name: preinstall-hook
  annotations:
    "helm.sh/hook": "pre-install"
    "helm.sh/hook-delete-policy": hook-succeeded
spec:
  containers:
  - name: pre-install-container
    image: busybox
    imagePullPolicy: IfNotPresent
    command: ['sh', '-c', 'echo The pre-install hook is running && sleep 20' ]
  restartPolicy: Never
  terminationGracePeriodSeconds: 0
---
# Source: my-app/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "python-my-app-test-connection"
  labels:
    helm.sh/chart: my-app-0.1.0
    app.kubernetes.io/name: my-app
    app.kubernetes.io/instance: python
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['python-my-app:8090']
  restartPolicy: Never
MANIFEST:
---
# Source: my-app/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: internal-app
  labels:
    helm.sh/chart: my-app-0.1.0
    app.kubernetes.io/name: my-app
    app.kubernetes.io/instance: python
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
automountServiceAccountToken: true
---
# Source: my-app/templates/secrets.yaml
apiVersion: v1
data:
  password: c210aCBpbiBiYXNlNjQgZm9ybWF0
metadata:
  name: secret-base
kind: Secret
---
# Source: my-app/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: configmap
data:
  config.json: |-
    {"key": "value"}
---
# Source: my-app/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: python-my-app
  labels:
    helm.sh/chart: my-app-0.1.0
    app.kubernetes.io/name: my-app
    app.kubernetes.io/instance: python
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
spec:
  type: LoadBalancer
  ports:
    - port: 8090
      targetPort: http
      protocol: TCP
      name: http
  selector:
    app.kubernetes.io/name: my-app
    app.kubernetes.io/instance: python
---
# Source: my-app/templates/statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: python-my-app
  labels:
    helm.sh/chart: my-app-0.1.0
    app.kubernetes.io/name: my-app
    app.kubernetes.io/instance: python
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
spec:
  podManagementPolicy: Parallel
  replicas: 2
  selector:
    matchLabels:
      app.kubernetes.io/name: my-app
      app.kubernetes.io/instance: python
  template:
    metadata:
      annotations:
        vault.hashicorp.com/agent-inject: "true"
        vault.hashicorp.com/agent-inject-secret-database-config.txt: internal/data/database/config
        vault.hashicorp.com/role: internal-app
      labels:
        helm.sh/chart: my-app-0.1.0
        app.kubernetes.io/name: my-app
        app.kubernetes.io/instance: python
        app.kubernetes.io/version: "1.16.0"
        app.kubernetes.io/managed-by: Helm
    spec:
      serviceAccountName: internal-app
      securityContext:
        {}
      containers:
        - name: my-app
          securityContext:
            {}
          image: "dshamik/dshamik_msk_time:latest"
          imagePullPolicy: IfNotPresent
          ports:
            - name: http
              containerPort: 8090
              protocol: TCP
          env:
            - name: PASSWORD
              valueFrom:
                secretKeyRef:
                  key: password
                  name: secret-base
          livenessProbe:
            httpGet:
              path: /
              port: http
          readinessProbe:
            httpGet:
              path: /
              port: http
          resources:
            {}
          volumeMounts:
            - mountPath: /config.json
              name: config
              readOnly: true
              subPath: config.json
            - mountPath: /app/volume/
              name: python-visits-pvc
      volumes:
        - configMap:
            name: configmap
          name: config
  volumeClaimTemplates:
    - metadata:
        name: python-visits-pvc
      spec:
        accessModes: [ "ReadWriteOnce" ]
        resources:
          requests:
            storage: 1Mi

NOTES:
1. Get the application URL by running these commands:
     NOTE: It may take a few minutes for the LoadBalancer IP to be available.
           You can watch the status of by running 'kubectl get --namespace default svc -w python-my-app'
  export SERVICE_IP=$(kubectl get svc --namespace default python-my-app --template "{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}")
  echo http://$SERVICE_IP:8090
```

## Task 2

```shell
~ kubectl get po,sts,svc,pvc

NAME                  READY   STATUS    RESTARTS   AGE
pod/python-my-app-0   1/1     Running   0          32s
pod/python-my-app-1   1/1     Running   0          32s

NAME                             READY   AGE
statefulset.apps/python-my-app   2/2     32s

NAME                    TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
service/kubernetes      ClusterIP      10.96.0.1        <none>        443/TCP          12d
service/python-my-app   LoadBalancer   10.104.228.164   <pending>     8090:31155/TCP   32s

NAME                                                      STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
persistentvolumeclaim/python-visits-pvc-python-my-app-0   Bound    pvc-c097de95-3836-4023-a97d-a5d8528220f8   1Mi        RWO            standard       4m14s
persistentvolumeclaim/python-visits-pvc-python-my-app-1   Bound    pvc-55652c51-b0f6-439b-be4d-0d97f2ae4554   1Mi        RWO            standard       4m14s
```

```shell
~ minikube service python-my-app

|-----------|---------------|-------------|---------------------------|
| NAMESPACE |     NAME      | TARGET PORT |            URL            |
|-----------|---------------|-------------|---------------------------|
| default   | python-my-app | http/8090   | http://192.168.49.2:31155 |
|-----------|---------------|-------------|---------------------------|
üèÉ  Starting tunnel for service python-my-app.
|-----------|---------------|-------------|------------------------|
| NAMESPACE |     NAME      | TARGET PORT |          URL           |
|-----------|---------------|-------------|------------------------|
| default   | python-my-app |             | http://127.0.0.1:56667 |
|-----------|---------------|-------------|------------------------|
üéâ  Opening service default/python-my-app in default browser...
‚ùó  Because you are using a Docker driver on darwin, the terminal needs to be open to run it.
```

```shell
~ kubectl exec python-my-app-0 -- cat /app/volume/visits

37
```

```shell
~ kubectl exec python-my-app-1 -- cat /app/volume/visits

32
```

### Parallel

```shell
~ kubectl get po

NAME              READY   STATUS    RESTARTS   AGE
python-my-app-0   1/1     Running   0          29s
python-my-app-1   1/1     Running   0          29s
```